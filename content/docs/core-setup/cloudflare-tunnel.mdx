---
title: 設定 Cloudflare Tunnel
description: 透過 Cloudflare Tunnel 為 LINE Webhook 提供安全的 HTTPS URL，無需開放防火牆。
---

## 為什麼需要 Cloudflare Tunnel？

- LINE Webhook 需要 HTTPS URL
- 不需要開放防火牆
- 提供固定網址（不像 ngrok 免費版會變）

## 前置步驟：在 Cloudflare 新增網域

<Callout type="warn">
必須先完成這一步，再執行後續的 `cloudflared tunnel login`，順序錯誤會導致 DNS 記錄加到錯誤的網域。
</Callout>

1. 登入 [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. 點 **Add a site**
3. 輸入你的網域
4. 選 **Free** 方案
5. 到你的網域註冊商，將 nameserver 改成 Cloudflare 提供的

## 安裝 cloudflared

```bash
curl -L --output cloudflared.deb https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
sudo dpkg -i cloudflared.deb
```

## 登入 Cloudflare

```bash
cloudflared tunnel login
```

瀏覽器會開啟，**務必選擇你要使用的網域**進行授權。

## 建立 Tunnel

```bash
cloudflared tunnel create openclaw-tunnel
# 記下 Tunnel ID，例如：8288b388-578e-4ebd-9560-2c1fecd453f0
```

## 設定 DNS 路由

```bash
cloudflared tunnel route dns openclaw-tunnel bot.<YOUR_DOMAIN>
```

## 建立設定檔

```bash
mkdir -p ~/.cloudflared
cat > ~/.cloudflared/config.yml << 'EOF'
tunnel: <TUNNEL_ID>
credentials-file: /home/<USERNAME>/.cloudflared/<TUNNEL_ID>.json

ingress:
  - hostname: bot.<YOUR_DOMAIN>
    service: http://localhost:18789
  - service: http_status:404
EOF
```

## 測試 Tunnel

```bash
cloudflared tunnel run openclaw-tunnel
# 看到 "Registered tunnel connection" 表示成功
# Ctrl+C 停止
```

## 設定為 systemd 服務

```bash
sudo tee /etc/systemd/system/cloudflared.service << 'EOF'
[Unit]
Description=Cloudflare Tunnel
After=network.target

[Service]
Type=simple
User=<USERNAME>
ExecStart=/usr/bin/cloudflared tunnel run openclaw-tunnel
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable cloudflared
sudo systemctl start cloudflared
```

## 確認 DNS 記錄

到 Cloudflare Dashboard → 你的網域 → DNS，確認有這筆記錄：

| Type | Name | Content |
|------|------|---------|
| CNAME | bot | `<TUNNEL_ID>.cfargotunnel.com` |

如果沒有，手動新增。
